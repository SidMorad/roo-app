<ion-header no-padding>
  <ion-navbar [hideBackButton]="true" no-padding>
    <ion-toolbar no-padding>
      <ion-grid>
        <ion-row>
          <ion-col col-auto>
            <span *ngFor="let i of [5, 4, 3, 2, 1]">
              <ion-icon name="star" color="gold" *ngIf="i > noWrong" style="zoom:1.2;"></ion-icon>
              <ion-icon name="star-outline" color="gold" *ngIf="i <= noWrong" style="zoom:1.2;"></ion-icon>
            </span>
          </ion-col>
          <ion-col col-auto>
            <progress [max]="questions.length" [value]="questionCounter-1"></progress>
          </ion-col>
          <ion-col col-1>
            <button ion-button icon-only clear small (click)="exit()" [style.color]="principal.isAuthenticated()? 'black' : 'red'">
              <ion-icon name="close"></ion-icon>
            </button>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-toolbar>
  </ion-navbar>
</ion-header>

<ion-content scrollDownOnLoad="true">
  <section class="question-container">
    <div class="quesiton-part">
      <div [class.alert-success]="wasCorrect && !wasAlmostCorrect"
           [class.alert-warning]="wasCorrect && wasAlmostCorrect"
           [class.alert-error]="wasWrong" style="padding: 5px; border: 1px solid transparent; border-radius: 16px; align-items: center;">
        <span class="float-left">
          <button ion-button icon-only clear color="dark" (click)="speak()">
            <ion-icon name="megaphone" *ngIf="autoPlayVoice"></ion-icon>
            <ion-icon name="ios-megaphone-outline" *ngIf="!autoPlayVoice"></ion-icon>
          </button>
        </span>
        <span class="float-right">
          <button ion-button icon-only clear color="dark" (click)="showHelp($event)" *ngIf="!wasWrong && !wasCorrect">
            <ion-icon name="help-buoy"></ion-icon>
          </button>
          <button ion-button icon-only clear color="dark" *ngIf="wasCorrect && !wasAlmostCorrect">
            <ion-icon name="happy"></ion-icon>
          </button>
          <button ion-button icon-only clear color="dark" *ngIf="wasCorrect && wasAlmostCorrect">
            <ion-icon name="ionitron"></ion-icon>
          </button>
          <button ion-button icon-only clear color="dark" *ngIf="wasWrong">
            <ion-icon name="sad"></ion-icon>
          </button>
        </span>
        <p [class.dir-rtl]="lesson.isMotherLangRTL()">&nbsp; {{question.description}}</p>
      </div>
      <div
          [class.dir-rtl]="lesson.isMotherLangRTL() && question.d.reverse"
          [class.dir-ltr]="lesson.isTargetLangLTR() && !question.d.reverse" class="question-question">
          {{questionFace}}
      </div>
      <div *ngIf="(wasWrong || wasAlmostCorrect) && isNotTypes(['TwoPicture', 'FourPicture', 'OneCheck'])" class="alert alert-info"
          [class.dir-rtl]="lesson.isMotherLangRTL() && !question.d.reverse"
          [class.dir-ltr]="lesson.isTargetLangLTR() && question.d.reverse">
        {{rightAnswerString}}
      </div>

      <div *ngIf="isType('OneCheck')">
        <ion-card [class.dir-rtl]="lesson.isMotherLangRTL() && question.isN()"
                  [class.dir-ltr]="lesson.isTargetLangLTR() && question.isR()">
          <ion-list radio-group>
            <span *ngFor="let choice of choices; let i = index;">
              <ion-item text-wrap *ngIf="(!wasWrong && !wasCorrect) || choice.isCorrect || choice.picked"
                   [class.alert-success]="wasCorrect && choice.isCorrect"
                   [class.alert-error]="wasWrong && choice.picked" id="radio-{{i}}">
                <ion-label (click)="oneChecked(i)">{{choice.text}}</ion-label>
                <ion-radio value="{{choice.text}}" (click)="oneChecked(i)"></ion-radio>
              </ion-item>
            </span>
          </ion-list>
        </ion-card>
      </div>

      <div *ngIf="isType('MultiSelect')">
        <div class="answer-background" id="answer-background">
          <div [class.dir-rtl]="lesson.isMotherLangRTL() && question.isN()" [class.alert-success]="wasCorrect && !wasAlmostCorrect" padding
               [class.dir-ltr]="lesson.isTargetLangLTR() && question.isR()" [class.alert-warning]="wasCorrect && wasAlmostCorrect"
                                                                            [class.alert-error]="wasWrong">
            <span class="answer" *ngFor="let chosen of chosens; let i = index;" (click)="moveBackToOptions(chosen)">
              <button class="{{chosen.class}} answer-contents" id="chosen-{{i}}">{{chosen.text}}</button>
            </span>
          </div>
        </div>
        <div [class.dir-rtl]="lesson.isMotherLangRTL() && question.isN()" padding
             [class.dir-ltr]="lesson.isTargetLangLTR() && question.isR()" id="optionsContainer">
          <span class="answer answer-container" *ngFor="let option of options; let i = index;" (click)="moveToChosen(option)" id="option-{{i}}">
            <button class="{{option.class}} answer-contents">{{option.text}}</button>
          </span>
        </div>
      </div>

      <div *ngIf="isType('Speaking')">
        <div class="answer-background dir-ltr" id="answer-background">
          <div  padding>
          <ion-spinner name="dots" *ngIf="microphonePressed"></ion-spinner>
            <div *ngIf="speakingAnswerDiff">
              <span *ngFor="let part of speakingAnswerDiff" [class.part-removed]="part.added" [class.part-added]="part.removed">{{part.value}}</span>
            </div>
          </div>
        </div>
        <a *ngIf="isType('Speaking')" (click)="skipSpeakingQuestions()" style="color:gray">{{'SKIP_MICROPHONE_QUESTIONS_FOR_NOW' | translate}}</a>
        <ion-fab center bottom large>
          <button ion-fab large color="{{microphonePressed ? 'danger' : 'primary'}}"
            (touchstart)="microphoneDown($event)" (touchend)="microphoneUp($event)" [disabled]="isChecking" id="speakingButton">
            <ion-icon name="microphone"></ion-icon>
          </button>
        </ion-fab>
      </div>

      <div *ngIf="isType('TwoPicture')">
        <ion-grid text-center>
          <ion-row (click)="twoPictureSelected(0)" text-center
                   [class.alert-warning]="question.d.pics[0].answered  && !wasCorrect && !wasWrong"
                   [class.alert-error]="question.d.pics[0].answered  && wasWrong"
                   [class.alert-success]="question.d.pics[0].answered && wasCorrect"
                   *ngIf="(!wasWrong && !wasCorrect) || twoPictureCorrectIndex === 0 || question.d.pics[0].answered">
            <ion-col col-3></ion-col>
            <ion-col col-6>
              <div class="relative-flex-1" id="twoPicture-0">
                <img [src]="resolveImageUrl(question.d.pics[0].name)" class="z_index_0"/>
                <button ion-button full small clear color="dark">{{question.pictureLabel(0)}}</button>
              </div>
            </ion-col>
            <ion-col col-3></ion-col>
          </ion-row>
          <ion-row (click)="twoPictureSelected(1)" text-center
                   [class.alert-warning]="question.d.pics[1].answered  && !wasCorrect && !wasWrong"
                   [class.alert-error]="question.d.pics[1].answered  && wasWrong"
                   [class.alert-success]="question.d.pics[1].answered && wasCorrect"
                   *ngIf="(!wasWrong && !wasCorrect) || twoPictureCorrectIndex === 1 || question.d.pics[1].answered">
            <ion-col col-3></ion-col>
            <ion-col col-6>
              <div class="relative-flex-1" id="twoPicture-1">
                <img [src]="resolveImageUrl(question.d.pics[1].name)" class="z_index_0"/>
                <button ion-button full small clear color="dark">{{question.pictureLabel(1)}}</button>
              </div>
            </ion-col>
            <ion-col col-3></ion-col>

          </ion-row>
        </ion-grid>
      </div>

      <div *ngIf="isType('FourPicture')">
        <ion-grid text-center>
          <ion-row text-center>
            <ion-col col-6 (click)="fourPictureSelected(0)"
                    [class.alert-warning]="question.d.pics[0].answered  && !wasCorrect && !wasWrong"
                    [class.alert-error]="question.d.pics[0].answered  && wasWrong"
                    [class.alert-success]="question.d.pics[0].answered && wasCorrect"
                    *ngIf="(!wasWrong && !wasCorrect) || fourPictureCorrectIndex === 0 || question.d.pics[0].answered">
              <div class="relative-flex-1" id="fourPicture-0">
                <img [src]="resolveImageUrl(question.d.pics[0].name)" class="z_index_0"/>
                <button ion-button full small clear color="dark">{{question.pictureLabel(0)}}</button>
              </div>
            </ion-col>
            <ion-col col-6 (click)="fourPictureSelected(1)"
                    [class.alert-warning]="question.d.pics[1].answered  && !wasCorrect && !wasWrong"
                    [class.alert-error]="question.d.pics[1].answered  && wasWrong"
                    [class.alert-success]="question.d.pics[1].answered && wasCorrect"
                    *ngIf="(!wasWrong && !wasCorrect) || fourPictureCorrectIndex === 1 || question.d.pics[1].answered">
              <div class="relative-flex-1" id="fourPicture-1">
                <img [src]="resolveImageUrl(question.d.pics[1].name)" class="z_index_0"/>
                <button ion-button full small clear color="dark">{{question.pictureLabel(1)}}</button>
              </div>
            </ion-col>
          </ion-row>
          <ion-row>
            <ion-col col-6 (click)="fourPictureSelected(2)"
                    [class.alert-warning]="question.d.pics[2].answered  && !wasCorrect && !wasWrong"
                    [class.alert-error]="question.d.pics[2].answered  && wasWrong"
                    [class.alert-success]="question.d.pics[2].answered && wasCorrect"
                    *ngIf="(!wasWrong && !wasCorrect) || fourPictureCorrectIndex === 2  || question.d.pics[2].answered">
              <div class="relative-flex-1" id="fourPicture-2">
                <img [src]="resolveImageUrl(question.d.pics[2].name)" class="z_index_0"/>
                <button ion-button full small clear color="dark">{{question.pictureLabel(2)}}</button>
              </div>
            </ion-col>
            <ion-col col-6 (click)="fourPictureSelected(3)"
                    [class.alert-warning]="question.d.pics[3].answered  && !wasCorrect && !wasWrong"
                    [class.alert-error]="question.d.pics[3].answered  && wasWrong"
                    [class.alert-success]="question.d.pics[3].answered && wasCorrect"
                    *ngIf="(!wasWrong && !wasCorrect) || fourPictureCorrectIndex === 3  || question.d.pics[3].answered">
              <div class="relative-flex-1" id="fourPicture-3">
                <img [src]="resolveImageUrl(question.d.pics[3].name)" class="z_index_0"/>
                <button ion-button full small clear color="dark">{{question.pictureLabel(3)}}</button>
              </div>
            </ion-col>
          </ion-row>
        </ion-grid>
      </div>

    </div>
  </section>
  <div style="position: absolute; bottom: 0px; width: 100%" text-center>
    <button ion-button full large color="secondary"
            *ngIf="isNotTypes(['FourPicture', 'TwoPicture']) && !wasWrong && !wasAlmostCorrect && !isChecking"
            [disabled]="!isAnswered()" (click)="check()" id="checkButton">
      {{'CHECK' | translate}}
    </button>
    <ion-spinner *ngIf="isChecking && autoContinue && !wasWrong && !wasAlmostCorrect" style="position:absolute; bottom: 1em; z-index: 10;" color="primary"></ion-spinner>
    <button ion-button full large color="secondary"
            *ngIf="wasWrong || wasCorrect" (click)="continue()">
      {{'CONTINUE' | translate}}
    </button>
  </div>
</ion-content>